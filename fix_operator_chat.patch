# Исправление: операторы могут писать в групповые чаты своего отдела

sed -i '115,124s/.*/        \/\/ For department chats, only heads and operators of same department can send\n        if (chat.type === '\''department'\'') {\n            \/\/ Allow head of the department\n            if (userRole === '\''head'\'' \&\& userDept === chat.department) {\n                return next();\n            }\n            \/\/ Allow operators of the same department\n            if (userRole === '\''operator'\'' \&\& userDept === chat.department) {\n                return next();\n            }\n            \/\/ Deny others\n            return res.status(403).json({ \n                error: '\''Only department members can send messages in department chats'\'',\n                code: '\''DEPARTMENT_ONLY'\''\n            });\n        }/' middleware/permissions.js
