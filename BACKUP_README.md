# üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã Production –¥–∞–Ω–Ω—ã—Ö

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
BACKUP_ENABLED=true
BACKUP_DIR=./backups
BACKUP_KEEP_DAYS=7
BACKUP_INTERVAL_HOURS=24
```

### 2. –ö–æ–º–∞–Ω–¥—ã

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —Å–µ–π—á–∞—Å
npm run backup

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
npm run backup:list

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
npm run restore

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm run backup:check
```

### 3. –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ—Ç–¥–µ–ª—ã, —á–∞—Ç—ã
- –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Ñ–∞–π–ª—ã
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ò—Å—Ç–æ—Ä–∏—è –∏ –ª–æ–≥–∏

‚úÖ **–§–∞–π–ª—ã (uploads/):**
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ê–≤–∞—Ç–∞—Ä—ã –∏ –º–∏–Ω–∏–∞—Ç—é—Ä—ã

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

–ë—ç–∫–∞–ø—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º `BACKUP_ENABLED=true`.

**–ü–µ—Ä–≤—ã–π –±—ç–∫–∞–ø:** —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
**–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ:** –∫–∞–∂–¥—ã–µ `BACKUP_INTERVAL_HOURS` —á–∞—Å–æ–≤

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab -e:
0 3 * * * cd /path/to/corporate-chat-backend && ./scripts/backup.sh backup >> /var/log/chat-backup.log 2>&1
```

### 5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
npm run restore
```

–í—ã–±–µ—Ä–∏—Ç–µ –±—ç–∫–∞–ø –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ.

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º!

```bash
# Docker
docker-compose down
npm run restore
docker-compose up -d

# PM2
pm2 stop chat-backend
npm run restore
pm2 start chat-backend
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤

```bash
ls -lh backups/
```

### –õ–æ–≥–∏

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker
docker-compose logs backend | grep Backup

# –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞–ø—Ä—è–º—É—é
grep Backup logs/app.log
```

## üö® –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

### –ò—Å–ø–æ—Ä—á–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. `npm run restore`
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –±—ç–∫–∞–ø
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. `npm install`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –±—ç–∫–∞–ø—ã –≤ `./backups/`
5. `npm run restore`
6. `npm start`

## üìÇ API endpoints (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

```http
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é
POST /api/admin/backup
Authorization: Bearer <admin_token>

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å
GET /api/admin/backups
Authorization: Bearer <admin_token>
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ë—ç–∫–∞–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `./backups/`
- –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—á–µ—Ä–µ–∑ `BACKUP_KEEP_DAYS` –¥–Ω–µ–π)
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –∫–æ–ø–∏—Ä—É–π—Ç–µ –±—ç–∫–∞–ø—ã –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

```bash
# –ü—Ä–∏–º–µ—Ä: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä
rsync -avz ./backups/ user@backup-server:/backups/corporate-chat/
```

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. [docs/BACKUP_RESTORE.md](docs/BACKUP_RESTORE.md)

---

**–ó–∞—â–∏—â–µ–Ω–æ:** –ß–∞—Ç—ã, –æ—Ç–¥–µ–ª—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø—Ä–∞–≤–∞, —Å–æ–æ–±—â–µ–Ω–∏—è, —Ñ–∞–π–ª—ã
**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –û–¥–∏–Ω –∫–ª–∏–∫ / –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
